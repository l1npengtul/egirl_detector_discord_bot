import tensorflow as tf
import numpy as np
from pathlib import Path
import time, calendar

'''


Trains and makes a tensorflow model to detect minecraft e-girls
l1npengtul Rho (C) 2020-2021
This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License along
    with this program; if not, write to the Free Software Foundation, Inc.,
    51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.


Tensorflow makes me want to cry ahhhhhhhhhhhhh
If you are here, enjoy a crying aqua in text form
:-::::://+++++osooo+/::::::::::/+ooooo+:-.......................................................:::-..............................-:::-...............---.......................................-+oooooo
::-::::::://+soooo+/::::::::::/+ooo+/-...........................................................::::................................:::--...............--....................................:+ooooooo
-----:---::/ooo+o+/::::::::://ooo+/-..............................................................:::-.................................-:::-...............--................................-:oooooosss
----------:ooooooo/:::::://++ooo/.......................................................-..........:::-..................................-:::-...............--..............................:oooooossss
----------+ooooooo+++++++ooooo/-........................................................--..........:::....................................-:::-..............-----........................-/oooo++ossss
---------:oooooooooooooooooo+-...........................................................--..........::-.....................................-:::-..............-:----------------..----..-+oooo++osssss
-------.-ooooooooooooooooo+:..............................................................:-..........:-.......................................-:::-.............-:----------------------:osooo++ossssss
--------:syoooooooooooooo/................................................................-:-..........-.........................................:::--.............-:-----------------::/osso+++ooosssss
--------+syysoooooooooo+-..................................................................::-..........-.........................................-:::-.............-::-------::::::::/ossso++oooossssss
-......-ssyhyyysssssss/-...-................................................................::-.........-...........................................-:::-.............::---:-::////:/+ossso++ossssssssss
:......-oshhhhhhhhyyy/...-..................................................................-/:-.........-...........................................-:::-.............-::--::://///ossssooossssssssssss
//-....:ooyyyhhhhhys:...-....................................................................-/:-........--............................................-:::-............-::::::///+ssssssossssssssssssss
::::---:///::/+osyo-..--......................................................................:/:-........-.............................................-:::-............-:/:::/+osssssssssssssssyysyyys
:::::::-......-://-..--........................................................................:::........-...............................................-::-.............://+ossssssssssssyyyyyyyyyyyy
+/::/-.........-:...--....................-.....................................................::-.......--.................................`.........-...-:::-...........-/osssssssssssyyyyyyyyyyyyyyh
////:.........--...--....................:-...................-................................../:-.......:..................................`........--....:/:-........-:+ssssssssyyyyyyyyyyyyyyyyyhhd
:::/:-.......--...--....................-/-..................-:--................................-/:-......:-........--..................-..............---...-/:-.....-:+sssssssyyyyyyyyyyyyyyyyyhhdddd
:::/+/:-----:....--....................-:/...................-::/.................................-/:......-:-.........--................--...............--...-::---:+osssssyyyyyyyyyyyyyyyyyyhhhdddddd
::::++//////.....-....................-::/...................:::+-..................``.............:/-.....-:-:-........---................--..............---..-//+osssssyyyyyyyyyyyyyyyyyhhhhddddhhhys
::::/+///+:.....:.....................:::/...................:::/:-..................`..............::-.....:--:-........--:-...............--..............--::/ossssyyyyyyyyyyyyyyyyyhhhhdddhhyyssoooo
:///:-:/+:...-.--....................-:::/...................:::/-:-..................`.............-/:.....-:--:-.........-::-..............---.........---/+osssyyyyyyyyyyyyyyyysyhhhhhyyyysooooo+++/+
:--....:/-...::-.....................:::/:...................:::/--:.................................-:-....-:----:-.........-:--..............---...--:/++osssssssssssoo+++///:::-+sssooooooo++++/////o
......-:+....-:.....................-:::/:..................-:://--::.................................--.....:-----::-........-:::-.............---..--------------:::/--........---+oooo++++++/////://o
....-::/+-...:-.....................-:::/:..................-::/:---:-.................................:-....:-------:-.........:/::-..........--.---...............--/:...........--++++++++//////:://o
..-::::/:-..--......................-:::/-..................-::/:----:-.................................-....-:--------:-........-//::-......---....---...............-:-............:////////::::::::/s
-:::::/:-:.-:.......................-:::/:.........--.......-::+:-----:-................................--...-:----.----::-........:///:--..--........--................----.........-////::::::::::///s
:///::/--:---.......................-:::/:-.........:.......-::/:------:-..---...........................--..-:----.`.----::-.......-:///:-:-..........---.................---........-/:::::::::::////s
+//////-..::........................-:::/:..........:-......-::/----.---:-...--...........................--..:----.`.`..---::-.......-::/o/-............-/:-...............--:-...--.-::://///////////s
///:---...--........................-:::/:..........::......-::/----..---:-...--...........................:-.:----.``````..---:--...-.-/+/://:-..........--::--..............--:----.--/:::::::::::::/s
:--..:....:-.........................::://..........::-....--::/----.`..--:-...::..........................-:--:---.`.```````..--::----::--::-:::-.........--::::---............--:---.-::::::::::::///s
-..--:...-:..........................::://.-........::-.....-:/:---.````.--:-..-/:-.........................-:-:---.`..````````...--/+/:-..--:---::---........-:::::::--.-........--:----/::///////////s
....--...--..........................-:::/..........:-:.....-:/:---...```.--:-..-::-.........................-::----.`````````..`..::/::::--.---..--:::---......-:::-::::---.....--.--:--://///////////o
....:-...--..........................-:::/..........:-:-...-.:/:---....``...-:-.--::--...............-........-/----.```.```.`...-::-....--::-----....--:::---....-:::--::+//:----.-----::///////:::::/+
....:-...:-...........................:::/-.......--:-::.....-/---....`````..-:-..-:::--............--.........-::--..```..`..-::::...`.`....--::::-.....---:::::----:::-:+::::-----------///:://////::/
....:-...--...........................-::/-........-:--:--...-/---.............--..::-::-...........--..........::::.......--:::-...............-+-...........--:::::::://+::::-..-----::-::////////////
-...:-...-............................-::/:......-.::--::-----:---...............---::-::-.....--..-:-.........--::::.....-----..............-:+yh+++++//::--.....----::::+:::::-.....----:ooooo+////::/
....::.--..............................-::-.......-:----:-----/:-.................---:---::----:-----............-::--..................-:+osyhddddddddddhhhyyso/-.......-/:::::--.-.------ooooooooo+/:/
..-.:-----............................--:::....----/-----:..--/::--.................------:::-:----:.-............-:--..............:/oyhhdddddhhhhyyyyyyyhhhdddhys+:...../::::::--.-------/syyyyyso+++/
..-.:-----..............................-::.....-.-:----.--.--:--..---:------........------://:-.-:-.-.............-:-...........:oyhhddhyyso+/:::---------:/+shddhh+...../::::::----------:osyhyyoo++++
-.../------.............................-::-....-.::----..-.--:-........--:::::::::::://:/::--::::-..--.............::........-+yhdhhso/:--.......-...````.....:yhh+....../:/://::----------+syyyyssoooo
..../:-----..........................-..--::--...-:----...--.::-..............----:::::::/:...--::--.-......-...-..--:-.....-+yhhhs/-....-:/+osyyyys/-.````````.-s:......./:/:///:----------/osyyyyysssy
..-.//:------...........................---/--..--:----....-.:--..........................-:.....-::--..............--:....-+hhy+-...-/ossyyhddddd+.`````````````........./:::///::-.-------:sssssyhyyyh
.---+//:-..-.........-...................--::----::---.....--:-............................--......-::--........-...----...-ss/..`.+yyyysyyyhdhoydyo/:-..:+o/.```.........::://///:---------:soosssyhddh
--::+//::-----...........................---:----::---......-:-......................................--:---..........--:.../:..`./yhysyyyyhddddhddddddhhhhhhh+```.........:/://////----------+/+++++ossy
:://+////:::--..........................-----:---:---.......-:---...-:..................................-:--.........-.--.-..``.ohhyyyyhhddds++++hdddddhyysoo/```````.....-/://////:---------:-:::----::
//++/+//////.-..........................-----:---::--........-.....-s/.--://+++++++++//:..................-:--.......--.-...```-hdhhhhddddddysssyddddhs+++/-..````````...../://////:---------:----------
++///o//////.-..............-...........-.----:-::--.............-+hdyyhhddddddddddddddh+:....................----...-..--...``-hhhhysosyyyyyyyyyso+//+sso/`````````..`....:///////:----:----:----------
/////o/////+--.-..........................----:-::--.......-:+oyyhdddddhhhyyyssssssyyyhhhyo-.....................----.-..-...```+s////+o///////////++++++/:-...`````......../://////----::----:---------
/+//:///////--.---------................--..---::::....-:oshdddhhyso+/:---..-.........--://+/......................----.---....``-:-`.+o+///////////:::::::::---............-///////:---:/----:---------
-:----+/////:----........................------/::-.-+shdddhy+/--.......-:/+oosso++:-.```.............................-----........``.-----------------------................://////:---:/----/--:::--::
-:---/+//////------...................----------//oyddddho/-.....``-/+shdddddddo/-......`````.............................--.........----.....................................://////---//:---/:::::::::
-:-:///+////+-------....--..........-----------:oddddho:-....```./syssyyhdddddy.`````````````..................................................................................//////:--//:---/:::::::::
:://///+/////:-------------------------------:---hhs/-...`````-oyyyyyyyhddd+:odhs/:::/+s+.```..................................................................................-/////:-:///---/:::::::::
+///////s/////--------------------------.--::---:+:-...`````.ohyyyyyyhddddhhhddddddddddhy:```...................................................................................:////:-:///---::::::----
/////:--o+///+---------------------------:/----:---..``````/hhyyyyhdddds/:--:sdddhso+oo++.``.``................................................................................../////-////---::--------
:------::/+////----------------------------::--:---.``````+hdddddddddddoo+oyhhso+++ooooo/.```..`............................-:---................................................-////-////---:---------
------:--+/+//+--------------------------------:::--`````:hdddddddddddddhyso+::://+oo+/-..```...............................-::::---..............................................////:////:--:-----.---
.-----:--+//++/:------------------------------------.````/hdddddhsoooo+/:::::////:::--:---...................................:::::::--............................................:////////:--:--.......
-----:---/+///+o-------------------------------------.```-yhyso//////::::/:::------------....................................--::::::-............................................-////////:--::........
----:---:/o////+/-------------------------------------..``.-//.....//:::--------------........................................--::::-.............................................-////////:--::........
---:----//++//+//--------------------------------------.```````````.---------...................................................--:-...............................................+///////:--::--......
--/:---:///o//+//:-------------------------------------.`.````````.-------........................................................-................................................+///////:--::........
-/:----////o/++//+--------------------------------------````````..................................................................................................................-////////:--::........
:/----:////++o/////-------------------------------------..```.....................................................................................................................:////////:--::........
/-----//////s+////+--------------------------:-----------........................................................................................................................-/////////:--::........
-----://////o///////-------------------------::----------:.......................................................................................................................//////////:--:-........
-----//////++//////+:-------------------------::-----------.....................................................................................................................///////+++/:--:-........
----://////o////////+-------------------------:/----------:-.................................................................................................................../////++++++/::-:-........
----://///o/////////+/-------------------------:/----------:.................................................................................................................-////+++++o++/::-:.........
----/////++/////////++:-------------------------//----------:....................................................................................--.........................:///+++++++o++/-::/--------.
---://///o//////////o/+-------------------------://-----------....................................................................................:........................////++++++++so+/:::os:-------
---/////o+/////////++///-------------------------:/:-----------.............................................................................----..--.....................:////+++++++++sy+::::yh/-------
--:////+o//////////o///+:------------------------://:---------:...................................................................------.---....-..-...................-///++++++++++++sho::::yo+-------
--/////o///////////o////+-------------------------://:---------:.........................................................---------..................-.................:///+++++++++++++yho:::/o::/------
-:////++//////////++//////------:------------------:///----------....................................................----...........................................-///+++++++++++++++yhs:::/.-:::-----
-:////o///////////o//////+/-----/:------------------////--------:-...................................:-............--..............................................:///++++++++++++++++hhs::::...:/:----
-////o+///////////o///////+/----:/:------------------////--------:-..................................:-..--..-------.............................................-..+++++++++++++++++++hhy::::...-//:---
:////o///////////+o////////+/----:/-------------------////:-------:..................................:--...--....................................................``.++++++++++++++++++ohhy:::-....::/:--
////o+///////////o+/////////+/----:/:-----------------:////:-------:.................................:-.........................................................```./+++++++++++++++++sh+/:::....../:/--
///+o////////////o+//////////+/----//------------------:////:------::................................-........................................................``````/+++++++++++++++++s/.::::....../:::-
///o+///////////+o////////////+/----//------------------:////:------:-......................................................................................``````..:++s++++++++++++++:..:::.......:::/:
//+o////////++/++o//+////////////----//:-----------------://///------::-...............................................................................-::.``.````..-++s++++++++++++++-..:::.......-:::/
/+o+/+///+++++++oo++///////:--...:----//:-----------------://///:-----//:--..........................................................................-//::.````````..++s+++++++++++++/...::-.......-::::
/+s+++/+++++++++o+++++/:-..``````.-----//:-----------------:/+++/::--::/::::--.....................................................................://+/:-.````````..++s+++++++++++++-...::........-/:::
++o++++o++++++++sssyyo-```````````.-:---:/::---------------:://++//:::::/o+/::::--..............................................................-/+///++:-`````````../+s+++++++++++++...-:-........:/:::
+o++++o+++++++oyhhhhhhs:.```````````-:---://:-------------:::::/+++/:::::ohyyso+/:::---......................................................-:osyo++++o/-...``````..-oo++++++ooo+++:...-:........./+/::
+o+++oo+++++shhhhhhhhhhyo-```````````.::--:/+::---:-:--:---:::::/++++:::::shhhhhs+////:::--...............................................-:oyyyyyo++++++:............oo++oo+++oo+++....:-........./++:/
oo+++o++++++oyhhhhhhhhhhhy/.``````````.-:--::+/::::::::::::::::::/++++:::::shdddhh/:://////:::--.....................................-:/+syhdhyyys+++++++-............oo++o+ooooo++-....:..........+++//
s+++oo++++++++syhhhhhhhhhhhs/.``````````.-:-:://:::::::::::::::::::/+++/::::yddddhy/:::::::://////:::---------..........---------::+syyhhhdddyyyyo+++++o/-............+o+ooooooooo/...............-o+o+/
s+++o+++++++++++oyhhhhhhhhhhhs:.`````````.-:::::/:::::::::::::::::::/++y+:::/yddhddy/:::::::::::::::::::::::::::::::::::::::::::/oyhhhhhddddhyyyy++++++++:............/o+ooooooooo-...............-oooo/
o++oo++++++++/:..-/shhhhhhhhhhyo:.`````````.-:::::::::::::::::::::::::/sho:::/yddhhdyo/::::::::::/++ooooo+/:::::::::::::::::::/ohdhddddddddhhhhhy+++++++o/-.........../+ooooooooo/-...............:++oo+
+++o++++++++:......./syhhhhhhhhhyo:.`````````.:::::/:::::::::::::::::::/hdy/::/yddhhhhhyo+/:::::/yhhhhhhhdy/::::::::::::::::+shhhddddddddhhyyhhhyoo+++++++-...........++oooooooo+::.............../-::+o
+++o+++++++-.........-/syhhhhhhhhhyo:...``````.-::::/:::::::::::::::::::+ddho/:/ydddhhhhhhyso+///yhhdhhdddhy+//:::::::::::/shdddddddddddhyyyyyyyyo++++++++-...........+ooooooooy/:::.............-:----:
++oo++++++-............-/oyhhhhhhhhhhs/...```.`..-:::/:::::::::::::::::::sddds/:/hdmdddhhdhdhhhyyyddddddddddhyyyyssso+++/+hddddddddddddhhhhyhyyys+++++++++-...........ooooooooyhs/::-............:------
++s++++++:...............-:+shhhhhhhhhhy+-....``...-:::/:::::::::::::::::/yhhdho/+hdddddddddddddddddddddddddddddhddhddhhhdddddddddddddhhhyhyyyys++++++++++...........-oooooooydhho:::-...........:------
+os++++++..................-:/oyhhhhhhhhhyo/.....`....::/:::::::::::::::::+yyyhhs++hdddddddddddddddddddddddddddddddddddddddddddddddmdhhhhhhyyyo++++++++++/...........:ooooooydhhhh//::..........-/:---:-
+oo+++++:....................-::/oyhhhhhhhhhy+:...`.....-//:::::::::::::::/oyyyyyyo+hdddddddmmmdddddddddddddddddddddddddddddddddddmmhhhhhhyys+++++++++++o-.........../oooooo/hhhhhy/::-........./++:-:/-
+s++++++-.....................--:::+syhhhhhhhhhs/-........-::::::::::::::::/oosyyyyysdddddddddddddmmmdddddddddddddddddddddddddddmmmhhhhyyso++++++++++++++............+oooo+-./hhhhh+::-........-ooo/:/:-
+s++++++.........................-:::/+syhhhhhhhhhs/-.......-+:::::::::://///o++osyyhhdhddmdddddddddddddmmmmmmddddddddddddddddmmdmhhhhhys++++++oo+++++++-...........-oooo/....shhhhy//-......../ooo+/:--
os++++++...........................-:::::/oyhhhhhhhhys/-....-++//:/::::://////o++++syyhhhhdddddddddddddddddddddddmmmmmmmmmmmmdddmhhhhhyo++++++s+++ooo+/-............/ooo/.....:hhhhho/-.......-+ooo/:::-
os++++++.............................-::::::/+shhhhhhhhhs+-..++++/://://///////o+++++syyhhhhhhhhddmmdddddddddddddddddddddddddddmhhhhhys++++++o+////::-.............-ooo/:......shhhhs/:......./ooo::::::
os++++++...............................-::::::::/syhhhhhhhhysy+++++/////////////o++++shysyyhyhhhhhhhddmmmmdddddddddddddddddddmdhhhhhhy++++++os///:-..............-:+o+:--:.....:hhhhh-:-.....-++/:::-:::
wow such good use of comments!
'''
print("""
egirl_detect_dc_bot ml_tensorflow  Copyright (C) 2020-2021  l1npengtul Rho
    This program comes with ABSOLUTELY NO WARRANTY; for details type `show w'.
    This is free software, and you are welcome to redistribute it
    under certain conditions; type `show c' for details.
""")

mcskins = Path('data_snapshot/')
testing_images = Path('testing_data/')
# Get count of all images in download folder with ending '.png'
# The */* is some regex for *(all sub directories)/*(all files in sub directory)
image_count = len(list(mcskins.glob('*/*.png')))
testing_count = len(list(testing_images.glob('*/*.png')))
print(image_count)
print(testing_count)

# Numpy Arrays are faster than python array
# Fill the array with the names of catagories, in this case ['female_skins', 'male_or_other_skins']
CATAGORIES = np.array([item.name for item in mcskins.glob('*')])

print(CATAGORIES)

# Flatten the image from 0-255 to 0.0-1.0
gen_img = tf.keras.preprocessing.image.ImageDataGenerator(rescale=1. / 255)

# Configuration
BATCH_SIZE = 20
IMG_HEIGHT = 64
IMG_WIDTH = 64

STEPS_PER_EPOCH = np.ceil(image_count / BATCH_SIZE)

# Process the data
training_data, label_train = next(gen_img.flow_from_directory(directory=str(mcskins),
                                            batch_size=BATCH_SIZE,
                                            shuffle=True,
                                            target_size=(IMG_HEIGHT, IMG_WIDTH),
                                            class_mode='binary',
                                            color_mode='rgba'))

testing_data, label_test = next(gen_img.flow_from_directory(directory=str(testing_images),
                                           batch_size=BATCH_SIZE,
                                           shuffle=True,
                                           target_size=(IMG_HEIGHT, IMG_WIDTH),
                                           class_mode='binary',
                                           color_mode='rgba'))

model = tf.keras.Sequential([
    # Instead of a 4D array , convert it into a flattened 64*64*4 1D array
    tf.keras.layers.Flatten(input_shape=(64, 64, 4)),
    # Hidden Second Layer
    # the bigger the number the bigger the RAM useage
    tf.keras.layers.Dense(200, activation='relu'),
    # Boolean Output
    tf.keras.layers.Dense(1)
])

# ReLU activation is f(x) = max(0,x)
# ReLU is very simple and fast compated to tanh(x) and other methods
# That is why we use ReLU = no reason to use other method(msot data points arn't near 0)

model.compile(optimizer='adam',
              # Use a loss function (Determine wrongness) from the binary output
              loss=tf.keras.losses.BinaryCrossentropy(from_logits=True),
              # Use accuracy for loss
              metrics=['accuracy'])

# Train the model using the training data in 10 batches
# :crab: my CPU and RAM gone :crab:
model.fit(training_data, label_train, epochs=70)

# Test the AI
test_loss, test_acc = model.evaluate(testing_data, label_test, verbose=2)

print('\nTest accuracy:', test_acc)
print(label_test)
print(type(label_test))
current_time = calendar.timegm(time.gmtime())
# save the model


model.save(f"trained_models/model_{current_time}.h5")
